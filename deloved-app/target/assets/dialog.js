function dialog(a,b,c){b||(b={}),b.url=a,b.fn=c,b.arg=Array.prototype.slice.call(arguments,3);var d=new Dialog(b);d.html?f_get(Dialog.path+d.html,function(a){d.tpl=a,d.open.call(d)}):d.open()}Dialog=function(a){this.style=function(){var a=document.getElementsByTagName("link"),b=document.createElement("link");b.setAttribute("type","text/css"),b.setAttribute("rel","stylesheet"),b.setAttribute("href",Dialog.path+this.css);for(var c in a)"stylesheet"==a[c].rel&&b.href==a[c].href&&(b=a[c]);return document.body.appendChild(b),b},this.type=function(){if(/^\w+$/g.test(this.url)&&(this.url=document.getElementById(this.url)),"string"!=typeof this.url)return 2;var a=this.url.substring(this.url.lastIndexOf(".")+1).toLowerCase();return"jpg"==a||"png"==a||"jpeg"==a||"gif"==a?1:0},this.open=function(){var a=this;if(a.window&&"none"==a.window.style.display)return a.show();var b=['<iframe id="'+a.id+'_data" onload="Dialog.objects[\''+a.id+'\'].onload()" src="'+a.url+'"></iframe>','<img id="'+a.id+'_data" onload="Dialog.objects[\''+a.id+'\'].onload()" src="'+a.url+'">','<div id="'+a.id+'_data"></div>'],c=a.tpl.replace("{data}",b[a.type()]).replace(/\{id\}/g,a.id);c=c.replace("{title}",a.title||"").replace("{caption}",a.caption||""),a.bg&&a.bg.parentNode||(a.bg=Dialog.add("a")),a.bg.className="dialog-bg dialog-load",a.bg.onclick=function(){a.close()},a.window&&a.window.parentNode||(a.window=Dialog.add("div")),a.window.innerHTML=c,a.window.style.display="none",2==a.type()&&(document.getElementById(a.id+"_data").innerHTML=a.url.innerHTML,a.onload())},this.onload=function(){var a=this,b=document.getElementById(a.id+"_data"),c=a.window.firstElementChild.style;a.bg.className="dialog-bg",a.window.style.display="block";var d=a.width&&a.width.toString().indexOf("%")>0?Math.round(parseInt(a.width)*innerWidth/100):a.width,e=a.height&&a.height.toString().indexOf("%")>0?Math.round(parseInt(a.height)*innerHeight/100):a.height,f=a.x&&a.x.toString().indexOf("%")>0?Math.round(parseInt(a.x)*innerWidth/100):a.x,g=a.y&&a.y.toString().indexOf("%")>0?Math.round(parseInt(a.y)*innerHeight/100):a.y,h=a.window.firstElementChild.offsetWidth-b.offsetWidth,i=a.window.firstElementChild.offsetHeight-b.offsetHeight;return!e&&!d&&b.offsetWidth>innerWidth-h&&b.offsetWidth/innerWidth>=b.offsetHeight/innerHeight&&(d=innerWidth-2*h),!e&&!d&&b.offsetHeight>innerHeight-i&&b.offsetWidth/innerWidth<b.offsetHeight/innerHeight&&(e=innerHeight-2*i),f&&(c.left=f+"px"),g&&(c.top=g+"px"),d&&(b.style.width=d+"px"),e&&(b.style.height=e+"px"),a.window.className=a.class,a.fn?a.fn.apply(a.fn,a.arg):void 0},this.hide=function(){this.window.style.display="none",this.bg.className=""},this.show=function(){this.window.style.display="block",this.bg.className="dialog-bg"},this.close=function(){var a=document.body;a.removeChild(this.bg),a.removeChild(this.window)},this.id=a.id||"dialog";var b=Dialog.objects[this.id]?Dialog.objects[this.id]:this,c="url,fn,arg,width,height,x,y,title,caption,css,html,tpl,class".split(",");for(var d in c)b[c[d]]=void 0!=a[c[d]]?a[c[d]]:void 0;return b.tpl||(b.tpl='<div class="dialog" id="{id}"><a onclick="Dialog.objects[\'{id}\'].close()" class="dialog-close"></a><a onmousedown="dnd(event,\'#{id}\')" class="dialog-move"></a><a href="http://akonan.ru" target="_blank" class="dialog-copy">Created by A.Konan</a><div class="dialog-title">{title}</div><div class="dialog-data">{data}</div><div class="dialog-caption">{caption}</div></div>'),b.css||(b.css="../css/dialog.css"),b.class||(b.class=a.x||a.y?"dialog-open":"dialog-center"),b.link=b.style(),Dialog.objects[b.id]=b},Dialog.add=function(a){var b=document.createElement(a);return document.body.appendChild(b),b},Dialog.inc=function(a){var b=document.createElement("script");b.src=a,document.getElementsByTagName("head")[0].appendChild(b)},Dialog.path=function(){var a,b="",c=document.getElementsByTagName("script");for(var d in c)c[d].src&&c[d].src.indexOf("dialog.js")>0&&(a=c[d].src.split("/").slice(0,-1));var e=location.href.split("/").slice(0,-1);for(var d in e)e[d]!=a[d]&&(b+="../");for(var d in a)e[d]!=a[d]&&(b+=a[d]+"/");return b}(),Dialog.init=function(){"f_get"in window||Dialog.inc(Dialog.path+"file.js"),"dnd"in window||Dialog.inc(Dialog.path+"dnd.js")}(),Dialog.objects=[];