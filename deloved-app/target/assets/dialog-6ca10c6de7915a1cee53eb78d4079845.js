function dialog(url,a,fn){a||(a={}),a.url=url,a.fn=fn,a.arg=Array.prototype.slice.call(arguments,3);var d=new Dialog(a);d.html?f_get(Dialog.path+d.html,function(t){d.tpl=t,d.open.call(d)}):d.open()}Dialog=function(a){this.style=function(){var l=document.getElementsByTagName("link"),e=document.createElement("link");e.setAttribute("type","text/css"),e.setAttribute("rel","stylesheet"),e.setAttribute("href",Dialog.path+this.css);for(var i in l)"stylesheet"==l[i].rel&&e.href==l[i].href&&(e=l[i]);return document.body.appendChild(e),e},this.type=function(){if(/^\w+$/g.test(this.url)&&(this.url=document.getElementById(this.url)),"string"!=typeof this.url)return 2;var p=this.url.substring(this.url.lastIndexOf(".")+1).toLowerCase();return"jpg"==p||"png"==p||"jpeg"==p||"gif"==p?1:0},this.open=function(){var t=this;if(t.window&&"none"==t.window.style.display)return t.show();var b=['<iframe id="'+t.id+'_data" onload="Dialog.objects[\''+t.id+'\'].onload()" src="'+t.url+'"></iframe>','<img id="'+t.id+'_data" onload="Dialog.objects[\''+t.id+'\'].onload()" src="'+t.url+'">','<div id="'+t.id+'_data"></div>'],p=t.tpl.replace("{data}",b[t.type()]).replace(/\{id\}/g,t.id);p=p.replace("{title}",t.title||"").replace("{caption}",t.caption||""),t.bg&&t.bg.parentNode||(t.bg=Dialog.add("a")),t.bg.className="dialog-bg dialog-load",t.bg.onclick=function(){t.close()},t.window&&t.window.parentNode||(t.window=Dialog.add("div")),t.window.innerHTML=p,t.window.style.display="none",2==t.type()&&(document.getElementById(t.id+"_data").innerHTML=t.url.innerHTML,t.onload())},this.onload=function(){var t=this,d=document.getElementById(t.id+"_data"),s=t.window.firstElementChild.style;t.bg.className="dialog-bg",t.window.style.display="block";var w=t.width&&t.width.toString().indexOf("%")>0?Math.round(parseInt(t.width)*innerWidth/100):t.width,h=t.height&&t.height.toString().indexOf("%")>0?Math.round(parseInt(t.height)*innerHeight/100):t.height,x=t.x&&t.x.toString().indexOf("%")>0?Math.round(parseInt(t.x)*innerWidth/100):t.x,y=t.y&&t.y.toString().indexOf("%")>0?Math.round(parseInt(t.y)*innerHeight/100):t.y,dw=t.window.firstElementChild.offsetWidth-d.offsetWidth,dh=t.window.firstElementChild.offsetHeight-d.offsetHeight;return!h&&!w&&d.offsetWidth>innerWidth-dw&&d.offsetWidth/innerWidth>=d.offsetHeight/innerHeight&&(w=innerWidth-2*dw),!h&&!w&&d.offsetHeight>innerHeight-dh&&d.offsetWidth/innerWidth<d.offsetHeight/innerHeight&&(h=innerHeight-2*dh),x&&(s.left=x+"px"),y&&(s.top=y+"px"),w&&(d.style.width=w+"px"),h&&(d.style.height=h+"px"),t.window.className=t.class,t.fn?t.fn.apply(t.fn,t.arg):void 0},this.hide=function(){this.window.style.display="none",this.bg.className=""},this.show=function(){this.window.style.display="block",this.bg.className="dialog-bg"},this.close=function(){var b=document.body;b.removeChild(this.bg),b.removeChild(this.window)},this.id=a.id||"dialog";var d=Dialog.objects[this.id]?Dialog.objects[this.id]:this,p="url,fn,arg,width,height,x,y,title,caption,css,html,tpl,class".split(",");for(var i in p)d[p[i]]=void 0!=a[p[i]]?a[p[i]]:void 0;return d.tpl||(d.tpl='<div class="dialog" id="{id}"><a onclick="Dialog.objects[\'{id}\'].close()" class="dialog-close"></a><a onmousedown="dnd(event,\'#{id}\')" class="dialog-move"></a><a href="http://akonan.ru" target="_blank" class="dialog-copy">Created by A.Konan</a><div class="dialog-title">{title}</div><div class="dialog-data">{data}</div><div class="dialog-caption">{caption}</div></div>'),d.css||(d.css="../css/dialog.css"),d.class||(d.class=a.x||a.y?"dialog-open":"dialog-center"),d.link=d.style(),Dialog.objects[d.id]=d},Dialog.add=function(n){var e=document.createElement(n);return document.body.appendChild(e),e},Dialog.inc=function(a){var s=document.createElement("script");s.src=a,document.getElementsByTagName("head")[0].appendChild(s)},Dialog.path=function(){var p,r="",s=document.getElementsByTagName("script");for(var i in s)s[i].src&&s[i].src.indexOf("dialog.js")>0&&(p=s[i].src.split("/").slice(0,-1));var d=location.href.split("/").slice(0,-1);for(var i in d)d[i]!=p[i]&&(r+="../");for(var i in p)d[i]!=p[i]&&(r+=p[i]+"/");return r}(),Dialog.init=function(){"f_get"in window||Dialog.inc(Dialog.path+"file.js"),"dnd"in window||Dialog.inc(Dialog.path+"dnd.js")}(),Dialog.objects=[];